/root/maple079-docker/server/MapleStory-Server-079

/root/maple079-docker/server

# 语法: cp -r /源文件夹的路径/* /目标文件夹的路径/
# 示例:
cp -r /root/maple079-docker/server/MapleStory-Server-079* /root/maple079-docker/server

### **第一步：确认最终的文件结构**

在开始创建配置文件之前，请最后一次确认您的项目文件夹 `maple079-docker` 结构如下。这是所有后续步骤的基础。

```
maple079-docker/
├── server/                    <-- 这是你放好所有服务端文件的目录
│   ├── config/
│   ├── lib/
│   ├── start.sh
│   └── ... (其他所有服务端文件)
│
├── mysql-init/                <-- 用于初始化数据库的目录
│
└── ... (我们即将在这里创建 docker-compose.yml)
```

---

### **第二步：创建 `docker-compose.yml` (总指挥文件)**

这个文件是Docker的“总指挥”，它告诉Docker要启动哪些服务（数据库、游戏APP），以及它们之间如何关联。

**操作：** 在 `maple079-docker` 文件夹的**根目录**下（与 `server` 和 `mysql-init` 文件夹同级），创建一个名为 `docker-compose.yml` 的文件，将以下内容完整地复制进去。

YAML

```
version: '3.8'

services:
  # 1. MySQL 数据库服务
  db:
    image: mysql:5.7
    container_name: maplestory-db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 'your_very_secret_password' # <-- 【重要】在这里设置一个安全的数据库密码
      MYSQL_DATABASE: 'maplestory_079'          # Docker会自动创建这个数据库
    volumes:
      - ./mysql-init:/docker-entrypoint-initdb.d # 自动执行init文件夹内的SQL脚本
      - mysql-data:/var/lib/mysql              # 持久化数据库数据，防止数据丢失
    expose:
      - "3306"

  # 2. MapleStory 服务端应用
  app:
    build:
      context: ./server # Docker将去server目录里寻找Dockerfile来构建镜像
    container_name: maplestory-app
    restart: always
    depends_on:
      - db # 确保在app启动前，db服务已启动
    ports:
      # 将本机的端口映射到容器的端口，让游戏客户端可以连接
      - "8484:8484" # 登录端口
      - "7575:7575" # 频道1
      - "7576:7576" # 频道2
      # ... 如果您需要更多频道, 在此添加更多端口映射, 例如 "7577:7577"
    environment:
      DB_HOST: 'db' # 使用服务名'db'作为数据库主机地址，这是Docker内部网络
      DB_USER: 'root'
      DB_PASS: 'your_very_secret_password' # <-- 【重要】必须与上面设置的MYSQL_ROOT_PASSWORD完全一致

volumes:
  mysql-data:
```

**【务必操作】**: 请将文件中的两处 `your_very_secret_password` 替换为您自己的密码，并确保两处完全相同。
### **第三步：创建 `Dockerfile` (游戏服务端构建图纸)**

这个文件是游戏服务端容器的“构建图纸”，它告诉Docker如何一步步打包出一个包含Java环境和游戏代码的镜像。

**操作：** 在 `server` 文件夹**内部**（与 `start.sh` 文件放在一起），创建一个名为 `Dockerfile` 的文件，将以下内容完整地复制进去。

Dockerfile

```
# 使用一个包含 JDK 1.7 的轻量级官方基础镜像
FROM openjdk:7-jdk-slim

# 在容器内部创建一个工作目录
WORKDIR /app

# 将当前目录(即server文件夹)的所有内容复制到容器的/app目录
COPY . .

# 赋予启动脚本可执行权限，这一步很重要
RUN chmod +x ./start.sh

# 声明服务端需要暴露的端口（仅为信息展示，实际映射在docker-compose.yml中）
EXPOSE 8484 7575 7576

# 容器启动时执行的默认命令
CMD ["./start.sh"]
```